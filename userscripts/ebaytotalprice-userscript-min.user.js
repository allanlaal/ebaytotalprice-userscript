// ==UserScript==
// @name         ebaytotalprice-userscript
// @namespace    https://github.com/subz390
// @version      2.1.4.210131101045
// @description  Add the total eBay auction price including postage in the auction listing
// @author       SubZ390
// @license      MIT
// @run-at       document-idle
// @grant        none
// @noframes
// @include      /^https?://(ar|b[ory]|c[lor]|do|ec|gt|hn|il|kz|mx|ni|p[aerty]|ru|sv|uy|ve|www)\.ebay\.com/
// @include      /^https?://www\.ebay\.com\.au/
// @include      /^https?://www\.ebay\.co\.uk/
// @include      /^https?://www\.ebay\.(at|ca|de|es|fr|ie|it|nl|ph|pl)/
// @include      /^https?://www\.be(nl|fr)\.ebay\.be/
//
//
// ==/UserScript==

function e(e,t=!0){if("object"!=typeof e)return typeof e;if(null===e)return"null";const n=Object.prototype.toString.call(e).match(/\[object\s(\w+)\]/)[1];return!0===t?n.toLowerCase():n}function t(e,t,n){if(null===e)return null;n=n||1;const r=e.match(t);return r?"all"==n?r:r[n]?r[n]:r[0]:null}function n(e="",t,n=document){try{if(n=null===n?document:n,"string"==typeof e){if(""==e)return null;if("string"==typeof n){const e=document.querySelector(n);if(null==e)return null;n=e}return n.querySelector(e)}return e}catch(e){console.error(e)}}function r({selector:e=null,scope:t=document,t:r=!1,all:o=!1,contains:i=null,o:l=!1,i:c=""}={}){const s={l:{u:`${c}selector is undefined`,p:`${c}scope not found`}};if("language"===l)return s;try{if(null===e)return console.error(s.l.u),null;if(t!==document&&null===(t=n(t)))return null;if("scope"===l)return t;if("options"===l)return{selector:e,scope:t,t:r,all:o,contains:i,o:l};if(!0===o){const n=t.querySelectorAll(e);if(0===n.length)return null;if(!0===r){if(null!==i){const e=[];return n.forEach((t=>{-1!==t.textContent.search(i)&&e.push(t)})),0===e.length?null:e}return Array.from(n)}if(null!==i){for(let e=0;e<n.length;e++)if(-1!==n[e].textContent.search(i))return n;return null}return n}{const n=t.querySelector(e);return null===n||("string"==typeof i||i instanceof RegExp)&&-1===n.textContent.search(i)?null:!0===r?[n]:n}}catch(e){console.error(e)}}function o(...t){if(0==Object.keys(t).length)return null;if(""===t[0])return null;const n=((t,n,r,o)=>{let i,l,c,s;if("object"===e(t)){function u(e,t){const n=t.find((t=>e.hasOwnProperty(t)));return void 0!==n?e[n]:void 0}l=u(t,["option","options","property","props","properties"]),i=u(t,["object"]),s=u(t,["default"]),c=u(t,["action","callback"])}else l=t,s=void 0,c=void 0;if(void 0===l)return s;if("string"==typeof c&&"set"===c)return s;function p(e,t,n={}){return"function"==typeof t?t(e,n):e}if("object"===e(i)){if("array"===e(l)){for(let e=0;e<l.length;e++)if(i.hasOwnProperty(l[e])){const t=p(i[l[e]],c,i);if(void 0!==t)return t}}else if("string"==typeof l&&i.hasOwnProperty(l)){const e=p(i[l],c,i);if(void 0!==e)return e}}else if("array"===e(l)){for(let e=0;e<l.length;e++)if(void 0!==l[e]){const t=p(l[e],c,i);if(void 0!==t)return t}}else{const e=p(l,c,i);if(void 0!==e)return e}return s})({options:["object"==e(t[0])?t[0]:void 0],default:{m:/{([^{}]+)}/g,S:t[0]}});return"object"==e(t[1])?n.S.replace(n.m,((e,n)=>{for(let e=1;t[e];e++)if(t[e][n])return"function"==typeof t[e][n]?t[e][n]().toString():t[e][n];return e})):n.S.replace(n.m,((e,n)=>t[n]||e))}const i=/((\d+[,\.])+\d+)/,l=/((((AU|C|US) )?\$)|EUR|PHP|zł|£)/;function c(e){try{let n=t(e.textContent.trim(),i);return n=n.replace(/[,\.]/g,""),n=parseFloat(n),n}catch(e){return console.error(e),null}}function s({g:e,v:n,h:i=null,P:s,I:u=null}){const p=r({selector:e,all:!0,t:!0});if(p)for(let e=0;p[e];e++){const m=r({selector:n,scope:p[e]}),a=r({selector:s,scope:p[e],contains:/\d/});if(m&&a){const e=t(m.textContent.trim(),l),n=t(a.textContent.trim(),l);if(n&&n===e){const e=((c(m)+c(a))/100).toFixed(2),t=o(u||i,{itemPrice:m.textContent.trim(),itemShippingAmount:a.textContent.trim(),currencySymbol:n,totalPrice:e});i?m.insertAdjacentHTML("afterend",t):a.innerHTML=t}}}}((e,t)=>{const n=document.createElement("style");n.appendChild(document.createTextNode(".total-price{background:#bf0;color:#111!important;outline:2px solid;padding:1px 4px;margin-left:5px;font-size:20px!important;font-weight:400!important;}.s-item__detail{overflow:visible!important;}")),(({j:e=3,every:t=100,test:n=(()=>!1),C:r=(()=>null),timeout:o=(()=>null)}={})=>{if(!1===(()=>{const e=n();return!!e&&(r(e),!0)})()){const i=setInterval((()=>{const e=n();e&&(clearInterval(i),clearTimeout(l),r(e))}),t),l=setTimeout((()=>{clearInterval(i),o()}),1e3*e)}})({j:2,every:100,test:()=>document.querySelector("head"),C(e){e.appendChild(n)}})})(),(e=>{try{for(const[,t]of Object.entries(e))for(let e=0;e<t.T.length;e++){if(null!==n(t.T[e]))return void t.process()}}catch(e){console.error(e)}})({search:{T:["#mainContent ul.srp-results","#mainContent ul.b-list__items_nofooter"],process:()=>s({g:"#mainContent li.s-item",v:".s-item__price",P:".s-item__shipping",h:'<span class="total-price">{currencySymbol}{totalPrice}</span>'})},_:{T:["#mainContent ul#ListViewInner"],process:()=>s({g:"#mainContent li",v:".lvprice span",P:".lvshipping span.fee",h:'<span class="total-price">{currencySymbol}{totalPrice}</span>'})},A:{T:['#mainContent form[name="viactiondetails"]'],process:()=>(({g:e,v:n,F:i,h:s=null,P:u,U:p,I:m=null})=>{const a=r({selector:e});if(a){const e=r({selector:i,scope:a,contains:/\d/})||r({selector:n,scope:a,contains:/\d/}),f=r({selector:p,scope:a,contains:/\d/})||r({selector:u,scope:a,contains:/\d/});if(e&&f){const n=t(e.textContent.trim(),l),r=t(f.textContent.trim(),l);if(r&&r===n){const t=((c(e)+c(f))/100).toFixed(2),n=o(m||s,{itemPrice:e.textContent.trim(),itemShippingAmount:f.textContent.trim(),currencySymbol:r,totalPrice:t});s?e.insertAdjacentHTML("afterend",n):f.innerHTML=n}}}})({g:"#mainContent",v:'span[itemprop="price"]',F:"#prcIsumConv",P:"#fshippingCost",U:"#convetedPriceId",h:'<span class="total-price">{currencySymbol}{totalPrice}</span>'})}});

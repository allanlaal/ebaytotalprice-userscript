// ==UserScript==
// @name         ebaytotalprice-userscript
// @namespace    https://github.com/subz390
// @version      2.0.0.201218183259
// @description  Add the total eBay auction price + shipping = total in the auction listing
// @author       SubZ390
// @license      MIT
// @run-at       document-idle
// @grant        none
// @noframes
// @include      /^https?://www\.ebay\.co\.uk/
//
//
// ==/UserScript==

function e(e,t=!0){if("object"!=typeof e)return typeof e;if(null===e)return"null";const n=Object.prototype.toString.call(e).match(/\[object\s(\w+)\]/)[1];return!0===t?n.toLowerCase():n}function t(t,n="i"){try{return"regexp"==e(t)?-1!=document.location.href.search(t):"string"==e(t)?-1!=document.location.href.search(RegExp(t,n)):null}catch(e){console.error(e)}}function n(e,t,n){if(null===e)return null;n=n||1;let r=e.match(t);return r?"all"==n?r:r[n]?r[n]:r[0]:null}function r({selector:e=null,scope:t=document,array:n=!1,all:r=!1,contains:o=null,unittest:i=!1}={}){try{if(null===e)return null;if(t!==document&&null===(t=function(e,t,n=document){try{if("string"==typeof e){if("string"==typeof n){const e=document.querySelector(n);if(null==e)return null;n=e}return n.querySelector(e)}return e}catch(e){console.error(e)}}(t)))return null;if("scope"===i)return t;if(!0===r){const r=t.querySelectorAll(e);if(0===r.length)return null;if(!0===n){if(null!==o){let e=[];return r.forEach((t=>{console.log("element.textContent",t,t.textContent),-1!==t.textContent.search(o)&&e.push(t)})),0===e.length?null:e}return Array.from(r)}if(null!==o){for(let e=0;e<r.length;e++)if(-1!==r[e].textContent.search(o))return r[e];return null}return r}{const r=t.querySelector(e);return null===r||("string"==typeof o||o instanceof RegExp)&&-1===r.textContent.search(o)?null:!0===n?[r]:r}}catch(e){console.error(e)}}function o(...t){if(0==Object.keys(t).length)return null;if(""===t[0])return null;const n=function(t,n,r,o){let i,l,c,s;if("object"===e(t)){const e=(e,t)=>{const n=t.find((t=>e.hasOwnProperty(t)));return void 0!==n?e[n]:void 0};l=e(t,["option","options","property","props","properties"]),i=e(t,["object"]),s=e(t,["default"]),c=e(t,["action","callback"])}else l=t,s=void 0,c=void 0;if(void 0===l)return s;if("string"==typeof c&&"set"===c)return s;function p(e,t,n={}){return"function"==typeof t?t(e,n):e}if("object"===e(i)){if("array"===e(l)){for(let e=0;e<l.length;e++)if(i.hasOwnProperty(l[e])){const t=p(i[l[e]],c,i);if(void 0!==t)return t}}else if("string"==typeof l&&i.hasOwnProperty(l)){const e=p(i[l],c,i);if(void 0!==e)return e}}else if("array"===e(l)){for(let e=0;e<l.length;e++)if(void 0!==l[e]){const t=p(l[e],c,i);if(void 0!==t)return t}}else{const e=p(l,c,i);if(void 0!==e)return e}return s}({options:["object"==e(t[0])?t[0]:void 0],default:{regex:/{([^{}]+)}/g,template:t[0]}});return"object"==e(t[1])?n.template.replace(n.regex,(function(e,n){for(let e=1;t[e];e++)if(t[e][n])return"function"==typeof t[e][n]?t[e][n]().toString():t[e][n];return e})):n.template.replace(n.regex,(function(e,n){return t[n]||e}))}function i({listItemsSelector:e,itemPriceElementSelector:t,itemPriceElementTemplate:i=null,itemShippingElementSelector:l,itemShippingElementTemplate:c=null}){const s=r({selector:e,all:!0,array:!0});if(s)for(let e=0;s[e];e++){const p=r({selector:t,scope:s[e]}),m=r({selector:l,scope:s[e],contains:/\d/});if(p&&m){const e=n(p.textContent.trim(),/(\$|£|EUR)/),t=n(m.textContent.trim(),/(\$|£|EUR)/);if(t&&t===e){const e=parseFloat(n(p.textContent.trim(),/(\d+[\.,]\d+)/).replace(",","."))+parseFloat(n(m.textContent.trim(),/(\d+[\.,]\d+)/).replace(",",".")),r=o(c||i,{itemPrice:p.textContent.trim(),itemShippingAmount:m.textContent.trim(),shippingCurrencySymbol:t,totalPrice:e.toFixed(2)});i?p.insertAdjacentHTML("afterend",r):m.innerHTML=r}}}}!function(e,t){const n=document.createElement("style");n.appendChild(document.createTextNode(".total-price{background:#bf0;color:#111!important;outline:2px solid;padding:1px 4px;margin-left:5px;font-size:20px!important;font-weight:400!important;}.s-item__detail{overflow:visible!important;}")),document.head.appendChild(n)}();try{const e='<span class="total-price">{shippingCurrencySymbol}{totalPrice}</span>';t("\\/(b|str)\\/")?i({listItemsSelector:".s-item",itemPriceElementSelector:".s-item__price",itemShippingElementSelector:".s-item__shipping",itemPriceElementTemplate:e}):t("\\/sch\\/")?i({listItemsSelector:"#mainContent li",itemPriceElementSelector:".lvprice span",itemShippingElementSelector:".lvshipping span.fee",itemPriceElementTemplate:e}):t("\\/itm\\/")&&function({listItemsSelector:e,itemPriceElementSelector:t,convertPriceElementSelector:i,itemPriceElementTemplate:l=null,itemShippingElementSelector:c,convertShippingElementSelector:s,itemShippingElementTemplate:p=null}){const m=r({selector:e});if(m){const e=r({selector:i,scope:m})||r({selector:t,scope:m}),u=r({selector:s,scope:m,contains:/\d/})||r({selector:c,scope:m,contains:/\d/});if(e&&u){const t=n(e.textContent.trim(),/([^\d ]+) ?\d+\.\d+/),r=n(u.textContent.trim(),/([^\d ]+) ?\d+\.\d+/);if(r&&r===t){const t=parseFloat(n(e.textContent.trim(),/(\d+\.\d+)/))+parseFloat(n(u.textContent.trim(),/(\d+\.\d+)/)),i=o(p||l,{itemPrice:e.textContent.trim(),itemShippingAmount:u.textContent.trim(),shippingCurrencySymbol:r,totalPrice:t.toFixed(2)});l?e.insertAdjacentHTML("afterend",i):u.innerHTML=i}}}}({listItemsSelector:"#mainContent",itemPriceElementSelector:"#prcIsum_bidPrice",convertPriceElementSelector:"#prcIsumConv",itemShippingElementSelector:"#fshippingCost",convertShippingElementSelector:"#convetedPriceId",itemPriceElementTemplate:e})}catch(e){console.error(e)}
